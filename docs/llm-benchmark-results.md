# Lightweight LLM Benchmark Results for PHI Extraction

> **æ¸¬è©¦æ—¥æœŸ**: 2024-12-30  
> **æ¸¬è©¦ç’°å¢ƒ**: CPU-only (ç„¡ GPU)  
> **æ¸¬è©¦ä»»å‹™**: é†«ç™‚æ–‡æœ¬ PHI (Protected Health Information) æå–

## ğŸ“Š Benchmark ç¸½çµ

| æ¨¡å‹ | å¤§å° | å¹³å‡æ™‚é–“ | JSON æˆåŠŸç‡ | Precision | Recall | F1 Score | æ¨è–¦ |
|------|------|----------|-------------|-----------|--------|----------|------|
| **granite4:1b** | 3.3GB | 15.77s | 100% | 110.5% | 75.0% | **89.4%** | ğŸ† æœ€ä½³å“è³ª |
| **qwen2.5:1.5b** | 986MB | 4.21s | 100% | 100.0% | 50.0% | 66.7% | â­ æœ€ä½³å¹³è¡¡ |
| llama3.2:1b | 1.3GB | 8.30s | 100% | 42.3% | 78.6% | 55.0% | å¯ç”¨ |
| smollm2:360m | 725MB | 3.78s | 87.5% | 0.0% | 0.0% | 0.0% | âŒ ä¸æ¨è–¦ |

> **æ³¨æ„**: Precision > 100% è¡¨ç¤ºæ¨¡å‹æå–äº†æ¯”é æœŸæ›´å¤šçš„æ­£ç¢º PHIï¼ˆå¯èƒ½æ˜¯æ¸¬è©¦æ¡ˆä¾‹è¨­è¨ˆçš„å•é¡Œï¼‰

## ğŸ§ª æ¸¬è©¦æ¡ˆä¾‹

### Case 1: Simple Name (è‹±æ–‡ç°¡å–®)
```
Patient John Smith was admitted on 2024-01-15.
```
**Expected PHI**: `John Smith` (NAME), `2024-01-15` (DATE)

### Case 2: Complex Medical (å¤šé¡å‹)
```
Dr. Mary Johnson treated patient Wang Wei (MRN: A12345678) 
at Taipei General Hospital. Contact: 0912-345-678.
```
**Expected PHI**: 2x NAME, ID, FACILITY, PHONE

### Case 3: Chinese Text (ä¸­æ–‡)
```
ç—…æ‚£é™³å¤§æ˜ï¼Œç”·æ€§ï¼Œ92æ­²ï¼Œä½å€ï¼šå°åŒ—å¸‚ä¿¡ç¾©å€æ¾ä»è·¯100è™Ÿï¼Œæ–¼2024å¹´3æœˆ1æ—¥å…¥é™¢ã€‚
```
**Expected PHI**: NAME, AGE, LOCATION, DATE

### Case 4: Email Mixed (æ··åˆ)
```
Please contact patient's family at john.doe@email.com 
or call 02-2345-6789. Patient DOB: 1985-06-15.
```
**Expected PHI**: EMAIL, PHONE, DATE

## ğŸ“ˆ è©³ç´°åˆ†æ

### ğŸ† granite4:1b - æœ€ä½³å“è³ª

**å„ªé»**:
- F1 Score æœ€é«˜ (89.4%)
- JSON è¼¸å‡º 100% æˆåŠŸ
- ä¸­æ–‡æ”¯æ´å„ªç§€ (4/4 æ­£ç¢ºè­˜åˆ¥)
- IBM ä¼æ¥­ç´šæ¨¡å‹ï¼Œå°ˆç‚º tool-calling è¨­è¨ˆ

**ç¼ºé»**:
- é€Ÿåº¦è¼ƒæ…¢ (~16 ç§’/è«‹æ±‚)
- æ¨¡å‹è¼ƒå¤§ (3.3GB)

**é©ç”¨å ´æ™¯**: 
- ç”Ÿç”¢ç’°å¢ƒ
- éœ€è¦é«˜æº–ç¢ºåº¦çš„ PHI å»è­˜åˆ¥åŒ–
- æœ‰è¶³å¤ æ™‚é–“è™•ç†çš„æ‰¹æ¬¡ä½œæ¥­

### â­ qwen2.5:1.5b - æœ€ä½³å¹³è¡¡

**å„ªé»**:
- é€Ÿåº¦å¿« (~4 ç§’/è«‹æ±‚)
- JSON è¼¸å‡º 100% æˆåŠŸ
- æ¨¡å‹å° (986MB)
- å¤šèªè¨€æ”¯æ´å¥½

**ç¼ºé»**:
- Recall è¼ƒä½ (50%)ï¼Œå¯èƒ½éºæ¼ PHI
- F1 Score ä¸­ç­‰ (66.7%)

**é©ç”¨å ´æ™¯**:
- é–‹ç™¼æ¸¬è©¦ç’°å¢ƒ
- éœ€è¦å¿«é€Ÿå›é¥‹çš„å ´æ™¯
- è³‡æºå—é™ç’°å¢ƒ

### llama3.2:1b - é«˜å¬å›

**å„ªé»**:
- å¬å›ç‡æœ€é«˜ (78.6%)
- Meta å®˜æ–¹æ¨¡å‹ï¼Œæ›´æ–°ç©©å®š
- JSON è¼¸å‡ºç©©å®š

**ç¼ºé»**:
- ç²¾ç¢ºåº¦ä½ (42.3%)ï¼Œæœƒèª¤åˆ¤é PHI
- F1 Score è¼ƒä½ (55%)

**é©ç”¨å ´æ™¯**:
- éœ€è¦ä¸æ¼æ‰ä»»ä½• PHI çš„å ´æ™¯
- å¾ŒçºŒæœ‰äººå·¥å¯©æ ¸çš„æµç¨‹

### âŒ smollm2:360m - ä¸æ¨è–¦

**å•é¡Œ**:
- æ¨¡å‹å¤ªå° (360M åƒæ•¸)
- å®Œå…¨ç„¡æ³•ç†è§£ PHI æå–ä»»å‹™
- F1 Score = 0%

**çµè«–**: æ­¤ç´šåˆ¥æ¨¡å‹ä¸é©åˆ PHI ä»»å‹™

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### å®‰è£æ¨¡å‹

```bash
# æ¨è–¦ï¼šæœ€ä½³å“è³ª
ollama pull granite4:1b

# æ›¿ä»£ï¼šå¿«é€Ÿå¹³è¡¡
ollama pull qwen2.5:1.5b
```

### DSPy é…ç½®

```python
from medical_deidentification.infrastructure.dspy.phi_module import (
    configure_dspy_ollama,
    PHIIdentifier,
    LIGHTWEIGHT_MODELS,
)

# ä½¿ç”¨é è¨­æœ€ä½³æ¨¡å‹ (granite4:1b)
configure_dspy_ollama()

# æˆ–æŒ‡å®šå¿«é€Ÿæ¨¡å‹
configure_dspy_ollama(model_name="qwen2.5:1.5b")

# æŸ¥çœ‹å¯ç”¨æ¨¡å‹
for name, info in LIGHTWEIGHT_MODELS.items():
    print(f"{name}: {info['description']}")
```

### åŸ·è¡Œ Benchmark

```bash
# å®Œæ•´æ¸¬è©¦
python scripts/benchmark_lightweight_llms.py

# å¿«é€Ÿæ¸¬è©¦ï¼ˆæ¯æ¡ˆä¾‹ 1 æ¬¡ï¼‰
python scripts/benchmark_lightweight_llms.py --runs 1

# æ¸¬è©¦ç‰¹å®šæ¨¡å‹
python scripts/benchmark_lightweight_llms.py --models granite4:1b qwen2.5:1.5b
```

## ğŸ“‹ çµè«–èˆ‡å»ºè­°

| å ´æ™¯ | æ¨è–¦æ¨¡å‹ | åŸå›  |
|------|----------|------|
| **ç”Ÿç”¢ç’°å¢ƒ** | `granite4:1b` | F1=89.4%ï¼Œå¯é çš„ JSON è¼¸å‡º |
| **é–‹ç™¼æ¸¬è©¦** | `qwen2.5:1.5b` | å¿« (4s)ï¼Œæ¨¡å‹å°ï¼Œè¿­ä»£å¿« |
| **é«˜å¬å›éœ€æ±‚** | `llama3.2:1b` | Recall=79%ï¼Œä¸æ¼æ‰ PHI |
| **è³‡æºæ¥µé™** | `qwen2.5:0.5b` | æœ€å°å¯ç”¨é¸é …ï¼ˆæœªæ¸¬è©¦ï¼‰ |

## ğŸ”® æœªä¾†æ¸¬è©¦è¨ˆåŠƒ

- [ ] qwen2.5:3b (ä¸­å‹)
- [ ] phi4-mini:3.8b (Microsoft)
- [ ] gemma3:1b (Google)
- [ ] ä½¿ç”¨ DSPy å„ªåŒ–å¾Œçš„æ•ˆæœæ¯”è¼ƒ

---

*Report generated by `scripts/benchmark_lightweight_llms.py`*
